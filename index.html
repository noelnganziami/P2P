<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P Reform Business</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
    <!-- Chart.js and jsPDF CDNs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf-plugin-autotable.min.js"></script>
</head>
<body>
    <nav class="main-nav">
        <div class="logo" onclick="handleLogoClick();"><i class="fas fa-chart-line"></i><span>P</span>P2P Reform</div>
        <ul id="nav-links">
            <li><a href="#" onclick="switchView('landing-page-view'); setActiveLink(this); return false;"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="#" onclick="switchView('about-view'); setActiveLink(this); return false;"><i class="fas fa-info-circle"></i> About</a></li>
            <li class="hidden"><button onclick="handleDashboardNavClick();" id="nav-dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</button></li>
            <li><a href="#" onclick="switchView('login-form-view'); setActiveLink(this); return false;" id="nav-login"><i class="fas fa-sign-in-alt"></i> Login</a></li>
            <li><a href="#" onclick="switchView('register-form-view'); setActiveLink(this); return false;" id="nav-register" class="nav-button-special"><i class="fas fa-user-plus"></i> Register</a></li>
            <li id="notification-bell-item" class="hidden" style="position:relative;">
                <button id="notification-bell-button" onclick="toggleNotificationPanel()">
                    <i class="fas fa-bell"></i>
                    <span id="unread-notification-count" class="hidden">0</span>
                </button>
                <div id="notification-panel" class="hidden">
                    <div id="notification-panel-list">
                        <p class="no-notifications">No new notifications.</p>
                    </div>
                </div>
            </li>
            <li class="hidden"><button onclick="handleLogout()" id="nav-logout"><i class="fas fa-sign-out-alt"></i> Logout</button></li>
        </ul>
    </nav>

    <div id="popup-notification-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-button" onclick="closePopupNotificationModal()">×</span>
            <h3 id="popup-notification-title">Notification</h3>
            <p id="popup-notification-message"></p>
            <button onclick="closePopupNotificationModal()" class="button accent">OK</button>
        </div>
    </div>

    <div id="custom-confirm-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-button" onclick="closeCustomConfirmModal(false)">×</span>
            <h3 id="custom-confirm-title">Confirmation</h3>
            <p id="custom-confirm-message"></p>
            <div style="text-align: right; margin-top: 1.5rem;">
                <button onclick="closeCustomConfirmModal(false)" class="button secondary">Cancel</button>
                <button onclick="closeCustomConfirmModal(true)" class="button" id="custom-confirm-ok-button">OK</button>
            </div>
        </div>
    </div>

    <div id="custom-prompt-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-button" onclick="closeCustomPromptModal(null)">×</span>
            <h3 id="custom-prompt-title">Input Required</h3>
            <p id="custom-prompt-message"></p>
            <input type="text" id="custom-prompt-input" style="margin-top: 0.5rem; margin-bottom: 1rem;">
            <div style="text-align: right; margin-top: 1.5rem;">
                <button onclick="closeCustomPromptModal(null)" class="button secondary">Cancel</button>
                <button onclick="closeCustomPromptModal(true)" class="button accent" id="custom-prompt-ok-button">Submit</button>
            </div>
        </div>
    </div>

    <div id="landing-page-view">
        <section class="hero-section">
            <video autoplay muted loop id="hero-video">
                <!-- Find a suitable stock video. This is a placeholder. -->
                <source src="https://assets.mixkit.co/videos/preview/mixkit-abstract-3d-background-and-sphere-of-flowing-lines-39904-large.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <div class="hero-overlay"></div>
            <div class="hero-content animate-on-scroll fade-in-up">
                <h1>The Future of Secure <br>P2P Asset Exchange</h1>
                <p>Your trusted platform for P2P coin exchange and profitable digital asset investments. Experience seamless, secure trading with global currency options.</p>
                <a href="#" onclick="switchView('register-form-view'); setActiveLink(document.getElementById('nav-register')); return false;" class="cta-button">
                    <i class="fas fa-rocket"></i> Get Started Now
                </a>
            </div>
        </section>

        <div class="features-overview">
            <h2 class="animate-on-scroll fade-in-up">Platform Highlights</h2>
            <p class="section-subtitle animate-on-scroll fade-in-up" data-delay="1">Empowering your financial journey with state-of-the-art tools and security.</p>
            <div class="info-grid">
                <div class="info-card animate-on-scroll fade-in-up" data-delay="2">
                    <i class="fas fa-exchange-alt"></i>
                    <strong>Admin-Brokered P2P</strong>
                    <span>Sell matured assets on our secure, admin-managed P2P market.</span>
                </div>
                <div class="info-card animate-on-scroll fade-in-up" data-delay="3">
                    <i class="fas fa-store"></i>
                    <strong>System Asset Programs</strong>
                    <span>Purchase asset programs directly from the system with defined returns.</span>
                </div>
                <div class="info-card animate-on-scroll fade-in-up" data-delay="4">
                    <i class="fas fa-piggy-bank"></i>
                    <strong>Asset Growth</strong>
                    <span>Watch your assets grow over a defined period and prepare them for market.</span>
                </div>
                 <div class="info-card animate-on-scroll fade-in-up" data-delay="5">
                    <i class="fas fa-user-shield"></i>
                    <strong>Secure Dashboard</strong>
                    <span>Track your assets, trades, and investments with institutional-grade security.</span>
                </div>
            </div>
        </div>
        
        <section class="how-it-works-section">
             <h2 class="animate-on-scroll fade-in-up">Simple Steps to Success</h2>
             <p class="section-subtitle animate-on-scroll fade-in-up" data-delay="1">Start your investment journey in just a few clicks.</p>
             <div class="steps-container">
                 <div class="step-card animate-on-scroll slide-in-left" data-delay="2">
                     <div class="step-icon"><i class="fas fa-user-plus"></i></div>
                     <h3>1. Create Account</h3>
                     <p>Register in minutes and create your secure digital wallet.</p>
                 </div>
                 <div class="step-arrow"><i class="fas fa-arrow-right"></i></div>
                 <div class="step-card animate-on-scroll fade-in-up" data-delay="3">
                     <div class="step-icon"><i class="fas fa-shield-alt"></i></div>
                     <h3>2. Get Verified</h3>
                     <p>Complete our fast and secure KYC process to unlock all features.</p>
                 </div>
                 <div class="step-arrow"><i class="fas fa-arrow-right"></i></div>
                 <div class="step-card animate-on-scroll slide-in-right" data-delay="4">
                     <div class="step-icon"><i class="fas fa-coins"></i></div>
                     <h3>3. Fund & Grow</h3>
                     <p>Purchase an asset program, watch it mature, and sell on the P2P market.</p>
                 </div>
             </div>
        </section>
    </div>

    <div id="about-view" class="main-content hidden">
        <div class="dashboard-card">
            <h3><i class="fas fa-info-circle"></i> About P2P Reform Business</h3>
            <p>P2P Reform Business is dedicated to revolutionizing how individuals interact with digital assets. Our platform provides a secure, transparent, and user-centric environment for peer-to-peer trading and strategic investments.</p>
            <p>Key features include a versatile P2P marketplace supporting various fiat currencies (USD, ZAR) and Bitcoin (BTC) for pricing COINs, alongside structured investment programs designed for asset growth. Additionally, users can purchase COINs directly from the system during admin-managed sale events. We simulate robust security measures, including escrow services and payment proof verification, to foster trust and safety within our community.</p>
            <p><em>Disclaimer: This platform is a demonstration project. No real financial transactions occur, and any resemblance to actual financial services is purely for illustrative purposes. Do not use real financial information.</em></p>
        </div>
    </div>

    <div id="register-form-view" class="form-view-container hidden">
        <div class="form-section">
            <h2 style="text-align: center;"><i class="fas fa-user-plus"></i> Create Your Account</h2>
            <label for="reg-name"><i class="fas fa-user"></i> Full Name:</label>
            <input type="text" id="reg-name" placeholder="Full Name">
            <label for="reg-email"><i class="fas fa-envelope"></i> Email:</label>
            <input type="email" id="reg-email" placeholder="Email address">
            <label for="reg-password"><i class="fas fa-lock"></i> Password:</label>
            <div class="password-field-container">
                <input type="password" id="reg-password" placeholder="Create a password">
            </div>
            <label class="show-password-label">
                <input type="checkbox" onclick="togglePasswordVisibility('reg-password')"> Show Password
            </label>
            <button onclick="handleRegister()" class="accent" style="width:100%; margin-top: 1.5rem;"><i class="fas fa-check-circle"></i> Register</button>
            <p style="text-align:center; margin-top:1rem; font-size:0.9rem;">Already have an account? <a href="#" onclick="switchView('login-form-view'); setActiveLink(document.getElementById('nav-login')); return false;">Login here</a></p>
        </div>
    </div>

    <div id="login-form-view" class="form-view-container hidden">
        <div class="form-section">
            <h2 style="text-align: center;"><i class="fas fa-sign-in-alt"></i> Welcome Back!</h2>
            <label for="login-email"><i class="fas fa-envelope"></i> Email:</label>
            <input type="email" id="login-email" placeholder="Your email address">
            <label for="login-password"><i class="fas fa-lock"></i> Password:</label>
             <div class="password-field-container">
                <input type="password" id="login-password" placeholder="Your password">
            </div>
            <label class="show-password-label">
                <input type="checkbox" onclick="togglePasswordVisibility('login-password')"> Show Password
            </label>
            <button onclick="handleLogin()" class="accent" style="width:100%; margin-top: 1.5rem;"><i class="fas fa-arrow-right"></i> Login</button>
            <p style="text-align:center; margin-top:1rem; font-size:0.9rem;">New user? <a href="#" onclick="switchView('register-form-view'); setActiveLink(document.getElementById('nav-register')); return false;">Create an account</a></p>
        </div>
    </div>

    <div id="user-dashboard-view" class="main-content hidden">
        <div class="dashboard-header-simple">
            <h2 id="user-welcome-message"></h2>
        </div>
        <div class="dashboard-layout">
            <aside class="dashboard-sidebar">
                <h3><i class="fas fa-compass"></i> Navigation</h3>
                <ul>
                    <li><button class="active" onclick="showUserDashboardSection('ud-overview', this)"><i class="fas fa-wallet"></i> Overview & Wallet</button></li>
                    <li><button onclick="showUserDashboardSection('ud-kyc', this)"><i class="fas fa-user-shield"></i> KYC Verification</button></li>
                    <li><button onclick="showUserDashboardSection('ud-system-sale', this)"><i class="fas fa-store"></i> Marketplace</button></li>
                    <li><button onclick="showUserDashboardSection('ud-my-assets', this)"><i class="fas fa-piggy-bank"></i> My Assets</button></li>
                    <li><button onclick="showUserDashboardSection('ud-p2p-market', this)"><i class="fas fa-exchange-alt"></i> P2P Market</button></li>
                    <li><button onclick="showUserDashboardSection('ud-pending-transactions', this)"><i class="fas fa-hourglass-half"></i> Pending Transactions</button></li>
                    <li><button onclick="showUserDashboardSection('ud-p2p-history', this)"><i class="fas fa-history"></i> P2P History</button></li>
                    <li class="hidden"><button onclick="showUserDashboardSection('ud-withdraw-funds', this)"><i class="fas fa-money-bill-wave"></i> Withdraw Funds</button></li>
                    <li><button onclick="showUserDashboardSection('ud-support-tickets', this)"><i class="fas fa-life-ring"></i> Support Tickets</button></li>
                </ul>
            </aside>
            <main class="dashboard-main-content">
                <div id="ud-overview" class="dashboard-card">
                    <h3><i class="fas fa-chart-pie"></i> Account Overview</h3>
                    <div class="info-grid" style="grid-template-columns: 1fr;">
                        <div class="info-card" id="user-coin-balance-card">
                            <i class="fas fa-coins"></i>
                            <strong>Liquid Coin Balance</strong>
                            <div><span id="coin-balance">0.00</span> COIN</div>
                        </div>
                    </div>
                     <div id="wallet-balances-grid" class="info-grid" style="margin-top: 1.5rem;">
                        <!-- Wallet balances will be populated here by JS -->
                    </div>
                    <div id="coin-chart-container" style="margin-top: 1.5rem;"> <canvas id="userCoinChart"></canvas> </div>
                    <button onclick="toggleUserProfileDetails()" id="toggle-profile-details-btn" class="button secondary" style="margin-top:1.5rem;"><i class="fas fa-user-circle"></i> Show Full Profile Details</button>
                    <div id="user-profile-details-collapsible" class="hidden">
                        <h4 style="margin-top:0; margin-bottom:1rem; padding-bottom:0.5rem; border-bottom: 1px solid var(--border-color)">Full Profile Details</h4>
                        <div class="info-grid">
                            <div class="info-card"><strong><i class="fas fa-envelope"></i> Email</strong><span id="profile-email"></span></div>
                            <div class="info-card"><strong><i class="fas fa-user-check"></i> KYC Status</strong><span id="profile-kyc-status" style="text-transform: capitalize;"></span></div>
                            <div class="info-card"><strong><i class="fas fa-university"></i> Bank Name</strong><span id="profile-bank-name"></span></div>
                            <div class="info-card"><strong><i class="fas fa-hashtag"></i> Bank Account</strong><span id="profile-bank-account"></span></div>
                            <div class="info-card"><strong><i class="fab fa-bitcoin"></i> USDT Wallet</strong><span id="profile-usdt-wallet"></span></div>
                            <div class="info-card"><strong><i class="fas fa-phone"></i> Telephone</strong><span id="profile-telephone"></span></div>
                            <div class="info-card"><strong><i class="fas fa-globe"></i> Country</strong><span id="profile-country"></span></div>
                        </div>
                    </div>
                </div>
                <div id="ud-kyc" class="dashboard-card hidden">
                    <h3><i class="fas fa-user-shield"></i> KYC Verification</h3>
                    <div id="kyc-status-display" style="margin-bottom: 1rem;">
                        <p>Your current KYC status is: <strong id="kyc-current-status-text" style="text-transform: capitalize;">Not Submitted</strong></p>
                        <p id="kyc-rejection-reason" class="hidden" style="padding:0.5rem; color: var(--danger-color); border: 1px solid var(--danger-color); border-radius:4px; background-color: #ffebee;"></p>
                    </div>
                    <div id="kyc-form-area">
                        <p id="kyc-form-instructions">Please fill out your details below and upload a verification document (e.g., ID, Passport). You can update these details at any time, which may require re-verification.</p>
                        <label for="kyc-bank-name"><i class="fas fa-university"></i> Bank Name:</label>
                        <input type="text" id="kyc-bank-name" placeholder="Your Bank Name">
                        <label for="kyc-bank-account"><i class="fas fa-hashtag"></i> Bank Account Number:</label>
                        <input type="text" id="kyc-bank-account" placeholder="Your Bank Account Number">
                        <label for="kyc-usdt-wallet"><i class="fab fa-bitcoin"></i> USDT Wallet Address (TRC20/ERC20):</label>
                        <input type="text" id="kyc-usdt-wallet" placeholder="Your USDT Wallet Address">
                        <label for="kyc-telephone"><i class="fas fa-phone"></i> Telephone Number (with country code):</label>
                        <input type="text" id="kyc-telephone" placeholder="+1234567890">
                        <label for="kyc-country"><i class="fas fa-globe"></i> Country of Residence:</label>
                        <select id="kyc-country"></select>
                        <label for="kyc-document"><i class="fas fa-id-card"></i> Upload Verification Document:</label>
                        <input type="file" id="kyc-document" accept="image/*,.pdf">
                        <p id="kyc-uploaded-file-name" style="font-size:0.85rem; margin-top:-0.5rem; margin-bottom:1rem;"></p>
                        <button onclick="submitKycForm()" class="accent" id="submit-kyc-button"><i class="fas fa-paper-plane"></i> Submit/Update KYC Information</button>
                    </div>
                    <div id="kyc-pending-approval-area" class="hidden" style="padding:1rem; background-color: #E1F5FE; border-left: 4px solid var(--accent-color); color: var(--primary-color);">
                        <p><i class="fas fa-hourglass-start"></i> Your KYC information has been submitted and is pending approval. You will be notified once it's reviewed.</p>
                    </div>
                     <div id="kyc-approved-area" class="hidden" style="padding:1rem; background-color: #E8F5E9; border-left: 4px solid var(--success-color); color: var(--primary-color);">
                        <p><i class="fas fa-check-circle"></i> Your KYC information has been approved! You now have full access to platform features.</p>
                        <p id="kyc-approved-update-info" class="hidden" style="font-size:0.9rem; margin-top:0.5rem;">To request an update to your KYC details, please contact support.</p>
                    </div>
                </div>
                <div id="ud-system-sale" class="dashboard-card hidden">
                    <h3><i class="fas fa-store"></i> Marketplace</h3>
                     <p id="system-sale-initial-purchase-message" class="hidden" style="padding:1rem; background-color: #E1F5FE; border-left: 4px solid var(--accent-color); color: var(--primary-color); margin-bottom: 1.5rem;">
                        Welcome! To start growing your assets, please make your first purchase from one of the seller's programs below.
                    </p>
                    <p id="countdown-timer-container">Marketplace Status: <span id="countdown-timer" style="font-weight:bold;">Loading...</span></p>
                    <div id="system-sale-plans-area" class="hidden">
                        <h4>Available Asset Programs & P2P Offers</h4>
                        <div id="user-system-sale-plans-list"></div>
                    </div>
                    <div id="system-sale-user-pending-message" class="hidden"></div>
                </div>
                <div id="ud-my-assets" class="dashboard-card hidden">
                    <h3><i class="fas fa-piggy-bank"></i> My Asset Programs</h3>
                    <p>This section shows all your purchased asset programs. Once an asset matures, you can list it for sale on the P2P market.</p>
                    <div id="user-assets-list" style="margin-top: 1.5rem;">
                        <p>You have not purchased any asset programs yet.</p>
                    </div>
                </div>
                <div id="ud-p2p-market" class="dashboard-card hidden">
                    <h3><i class="fas fa-exchange-alt"></i> My P2P Offers</h3>
                    <div id="p2p-market-disabled-message" class="hidden" style="padding:1rem; background-color: #FFF3E0; border-left: 4px solid var(--warning-color); color: var(--text-dark); margin-bottom: 1rem;">
                        <i class="fas fa-lock"></i> P2P market features are enabled after your first purchase from a Seller's Asset Program.
                    </div>
                    <p>Create sell offers from your "My Assets" page. Your active sell offers are shown below.</p>

                    <h4 style="margin-top: 1.5rem;">My Active P2P Sale Offers</h4>
                    <div id="my-sell-offers-list" class="data-table-wrapper" style="margin-bottom: 2rem;">
                        <p>You have no active sell offers.</p>
                    </div>
                </div>
                <div id="ud-pending-transactions" class="dashboard-card hidden">
                    <h3><i class="fas fa-hourglass-half"></i> My Pending Transactions</h3>
                    <p>This section includes your pending payments for Seller Asset Programs and P2P purchases.</p>
                    <div id="pending-transactions-list" style="margin-top: 1rem;"> <p>No pending transactions.</p> </div>
                </div>
                <div id="ud-p2p-history" class="dashboard-card hidden">
                    <h3><i class="fas fa-history"></i> My P2P Transaction History</h3>
                    <button onclick="exportP2PTransactionHistoryPDF()" class="secondary" style="float:right; margin-bottom:1rem;"><i class="fas fa-file-pdf"></i> Export PDF</button>
                    <div id="p2p-history-list" class="data-table-wrapper">
                        <p>No completed P2P transactions.</p>
                    </div>
                </div>
                <div id="ud-withdraw-funds" class="dashboard-card hidden">
                    <h3><i class="fas fa-money-bill-wave"></i> Withdraw Funds</h3>
                    <div class="form-section" style="padding:1rem; margin-bottom: 2rem;">
                        <h4>Request a Withdrawal</h4>
                        <p>Withdrawals are processed by admin within 48 hours (simulated). Funds will be sent to your KYC-verified bank/BTC account.</p>
                        <label for="withdraw-currency"><i class="fas fa-dollar-sign"></i> Select Currency to Withdraw:</label>
                        <select id="withdraw-currency">
                            <option value="USD">USD Wallet</option>
                            <option value="ZAR">ZAR Wallet</option>
                            <option value="BTC">BTC Wallet</option>
                        </select>
                        <label for="withdraw-amount"><i class="fas fa-calculator"></i> Amount to Withdraw:</label>
                        <input type="number" id="withdraw-amount" placeholder="0.00">
                        <div id="withdraw-destination-details" style="margin-top:0.5rem; margin-bottom:1rem; font-size:0.9rem; background-color: #f0f0f0; padding:0.5rem; border-radius:4px;">
                            <p><strong><i class="fas fa-map-marker-alt"></i> Destination:</strong> <span id="withdraw-destination-info">Please select currency.</span></p>
                        </div>
                        <button onclick="handleWithdrawalRequest()" class="accent"><i class="fas fa-paper-plane"></i> Submit Withdrawal Request</button>
                    </div>
                    <h4>My Withdrawal History</h4>
                    <div id="user-withdrawal-history-list" class="data-table-wrapper">
                        <p>You have no withdrawal requests yet.</p>
                    </div>
                </div>
                 <div id="ud-support-tickets" class="dashboard-card hidden">
                    <h3><i class="fas fa-life-ring"></i> Support Tickets</h3>
                    <div class="form-section" style="padding:1rem; margin-bottom: 2rem;">
                        <h4>Create New Ticket</h4>
                        <label for="ticket-subject"><i class="fas fa-heading"></i> Subject:</label>
                        <input type="text" id="ticket-subject" placeholder="e.g., KYC Update Request">
                        <label for="ticket-message"><i class="fas fa-comment-dots"></i> Message:</label>
                        <textarea id="ticket-message" rows="4" placeholder="Describe your issue or request..."></textarea>
                        <button onclick="createNewSupportTicket()" class="accent"><i class="fas fa-paper-plane"></i> Submit Ticket</button>
                    </div>
                    <h4>My Tickets</h4>
                    <div id="user-tickets-list" class="data-table-wrapper">
                        <p>You have not created any support tickets yet.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="admin-dashboard-view" class="main-content hidden">
         <div class="dashboard-header-simple">
            <h2 style="margin:0;"><i class="fas fa-user-cog"></i> Administrator Panel</h2>
        </div>
        <div class="dashboard-layout">
            <aside class="dashboard-sidebar">
                 <h3><i class="fas fa-bars"></i> Admin Menu</h3>
                <ul>
                    <li><button class="active" onclick="showAdminDashboardSection('ad-overview', this)"><i class="fas fa-tachometer-alt"></i> Overview & Stats</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-users', this)"><i class="fas fa-users"></i> User Management</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-kyc-requests', this)"><i class="fas fa-user-shield"></i> KYC Requests</button></li>
                    <li class="hidden"><button onclick="showAdminDashboardSection('ad-withdrawal-requests', this)"><i class="fas fa-hand-holding-usd"></i> Withdrawal Requests</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-system-sale-config', this)"><i class="fas fa-cogs"></i> System Config</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-system-sale-requests', this)"><i class="fas fa-file-invoice-dollar"></i> Seller Sale Requests</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-manage-p2p-offers', this)"><i class="fas fa-tasks"></i> Manage P2P Offers</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-p2p-tx', this)"><i class="fas fa-exchange-alt"></i> Active P2P Transactions</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-user-assets', this)"><i class="fas fa-chart-line"></i> All User Assets</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-support-tickets', this)"><i class="fas fa-life-ring"></i> Support Tickets</button></li>
                </ul>
            </aside>
            <main class="dashboard-main-content">
                <div id="ad-overview" class="dashboard-card">
                    <h3><i class="fas fa-chart-bar"></i> Admin Overview & Stats</h3>
                    <div class="info-grid">
                        <div class="info-card"><strong><i class="fas fa-users"></i> Total Users</strong><span id="admin-stat-total-users">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-coins"></i> Total COINs in Maturing Assets</strong><span id="admin-stat-total-coins">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-list-alt"></i> Active P2P Offers</strong><span id="admin-stat-active-p2p-offers">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-user-clock"></i> Pending KYC Requests</strong><span id="admin-stat-pending-kyc">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-hourglass-half"></i> Pending P2P Transactions</strong><span id="admin-stat-pending-p2p">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-shopping-cart"></i> Pending Seller Purchases</strong><span id="admin-stat-pending-system-purchases">0</span></div>
                        <div class="info-card hidden"><strong><i class="fas fa-hand-holding-usd"></i> Pending Withdrawals</strong><span id="admin-stat-pending-withdrawals">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-envelope-open-text"></i> Open Support Tickets</strong><span id="admin-stat-open-support-tickets">0</span></div>
                    </div>
                </div>
                <div id="ad-users" class="dashboard-card hidden">
                    <h3><i class="fas fa-users"></i> User Management</h3>
                     <div style="margin-bottom: 1rem;">
                        <input type="text" id="admin-user-search" placeholder="Search by name, email, or ID..." onkeyup="renderAdminUserList()" style="max-width: 300px;">
                    </div>
                    <div id="admin-user-list-area" class="data-table-wrapper">
                        <p class="loading-text">Loading users...</p>
                    </div>
                </div>
                <div id="ad-kyc-requests" class="dashboard-card hidden">
                    <h3><i class="fas fa-user-shield"></i> KYC Verification Requests</h3>
                    <div id="admin-kyc-requests-list" class="data-table-wrapper">
                        <p>No pending KYC requests.</p>
                    </div>
                </div>
                <div id="ad-withdrawal-requests" class="dashboard-card hidden">
                    <h3><i class="fas fa-hand-holding-usd"></i> User Withdrawal Requests</h3>
                    <div id="admin-withdrawal-requests-list" class="data-table-wrapper">
                        <p>No withdrawal requests found.</p>
                    </div>
                </div>
                <div id="ad-system-sale-config" class="dashboard-card hidden">
                    <h3><i class="fas fa-cogs"></i> System Configuration</h3>
                     <div class="form-section" style="padding: 1rem; margin-bottom:1.5rem;">
                        <h4>Default System Currency</h4>
                        <label for="admin-default-currency">Set Default Currency for P2P & New Plans:</label>
                        <select id="admin-default-currency">
                            <option value="USD">USD</option>
                            <option value="ZAR">ZAR</option>
                            <option value="BTC">BTC</option>
                        </select>
                        <button onclick="saveDefaultSystemCurrency()" class="accent"><i class="fas fa-save"></i> Save Default Currency</button>
                        <p style="font-size:0.85rem; margin-top:0.5rem;">Current Default: <strong id="current-default-system-currency-display">USD</strong></p>
                    </div>
                    <div class="form-section" style="padding: 1rem; margin-bottom:1.5rem;">
                        <h4>P2P Market Access Control</h4>
                        <p style="font-size: 0.9rem; margin-bottom: 0.5rem;">Enable this to force all new users to make a purchase from the seller before accessing the P2P market. This can be bypassed per-user during KYC approval.</p>
                        <label class="switch">
                            <input type="checkbox" id="admin-p2p-access-toggle" onchange="toggleP2PRequirementDefault()">
                            <span class="slider round"></span>
                        </label>
                        <span style="margin-left: 0.5rem; vertical-align: middle;" id="admin-p2p-access-status"></span>
                    </div>
                    <div class="form-section" style="padding: 1rem; margin-bottom:1.5rem;">
                        <h4>Sale Timers</h4>
                        <label for="admin-sale-duration">Sale Duration (seconds):</label>
                        <input type="number" id="admin-sale-duration" placeholder="e.g., 300 for 5 mins">
                        <label for="admin-cooldown-duration">Cooldown Between Sales (seconds):</label>
                        <input type="number" id="admin-cooldown-duration" placeholder="e.g., 60 for 1 min">
                        <button onclick="saveSystemSaleTimers()" class="accent"><i class="fas fa-save"></i> Save Timers</button>
                    </div>
                    <div class="form-section" style="padding: 1rem;">
                        <form id="plan-form">
                            <h4>Manage Seller's Asset Programs <small id="editing-plan-id" class="hidden">(Editing ID: <span></span>)</small></h4>
                            <div style="border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom:1rem;">
                                <h5>Add New Plan / Edit Plan</h5>
                                <label for="plan-name">Plan Name:</label>
                                <input type="text" id="plan-name" placeholder="e.g., Starter Pack">
                                <div class="form-inline-group" style="display: flex; gap: 1rem; align-items: flex-end;">
                                    <div style="flex-grow:1;">
                                        <label for="plan-cost">Cost:</label>
                                        <input type="number" id="plan-cost" placeholder="e.g., 20" style="margin-bottom:0;">
                                    </div>
                                    <select id="plan-currency" style="margin-bottom:0;">
                                        <option value="USD">USD</option>
                                        <option value="ZAR">ZAR</option>
                                        <option value="BTC">BTC</option>
                                    </select>
                                </div>
                                <div class="form-inline-group" style="display: flex; gap: 1rem; margin-top: 1rem;">
                                    <div style="flex-grow:1;">
                                        <label for="plan-coins-awarded">Base Coins Awarded:</label>
                                        <input type="number" id="plan-coins-awarded" placeholder="e.g., 40">
                                    </div>
                                    <div style="flex-grow:1;">
                                        <label for="plan-return-percentage">Return Percentage (%):</label>
                                        <input type="number" id="plan-return-percentage" placeholder="e.g., 50 for 50%">
                                    </div>
                                    <div style="flex-grow:1;">
                                         <label for="plan-maturity-value">Maturity Duration:</label>
                                        <div class="form-inline-group" style="display: flex; gap: 0.5rem; align-items: center;">
                                            <input type="number" id="plan-maturity-value" placeholder="e.g., 7" style="margin-bottom:0; flex-grow: 1;">
                                            <select id="plan-maturity-unit" style="margin-bottom:0; flex-grow: 1;">
                                                <option value="Days">Days</option>
                                                <option value="Hours">Hours</option>
                                                <option value="Minutes">Minutes</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <label for="plan-bank-name">Seller Bank Name (for this plan):</label>
                                <input type="text" id="plan-bank-name" placeholder="e.g., Seller Bank Inc.">
                                <label for="plan-bank-account">Seller Bank Account No.:</label>
                                <input type="text" id="plan-bank-account" placeholder="e.g., 987654321">
                                <label for="plan-btc-wallet">Seller BTC Wallet:</label>
                                <input type="text" id="plan-btc-wallet" placeholder="Seller Bitcoin Address for this plan">
                                <button type="button" onclick="handleAddOrUpdateSystemSalePlan()" class="accent" id="add-plan-button"><i class="fas fa-plus"></i> Add Plan</button>
                                <button type="button" onclick="clearPlanEditForm()" class="secondary hidden" id="cancel-edit-plan-button"><i class="fas fa-times"></i> Cancel Edit</button>
                            </div>
                        </form>
                        <h5>Existing Plans</h5>
                        <div id="admin-system-sale-plans-list" class="data-table-wrapper">
                            <p>No plans defined yet.</p>
                        </div>
                    </div>
                </div>
                <div id="ad-system-sale-requests" class="dashboard-card hidden">
                    <h3><i class="fas fa-file-invoice-dollar"></i> Seller Asset Purchase Requests from Users</h3>
                    <button onclick="clearSystemSaleRequestsLogs()" class="danger" style="float:right; margin-bottom:1rem;"><i class="fas fa-trash-alt"></i> Clear All Logs</button>
                    <div id="admin-system-purchase-requests-list" class="data-table-wrapper">
                        <p>No pending seller purchase requests.</p>
                    </div>
                </div>
                <div id="ad-manage-p2p-offers" class="dashboard-card hidden">
                    <h3><i class="fas fa-tasks"></i> Manage Active P2P Sell Offers</h3>
                    <p>Manage all active P2P sell offers created by users. You can repackage or remove offers if necessary.</p>
                    <div id="admin-p2p-offers-list" class="data-table-wrapper" style="margin-top: 1rem;">
                        <p>No active P2P sell offers from users at the moment.</p>
                    </div>
                </div>
                <div id="ad-p2p-tx" class="dashboard-card hidden">
                     <h3><i class="fas fa-exchange-alt"></i> Active P2P Transactions</h3>
                     <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 1rem;">
                        <div>
                            <label for="admin-p2p-filter-status" style="margin-right: 0.5rem; display:inline-block;">Filter by Status:</label>
                            <select id="admin-p2p-filter-status" onchange="renderAdminP2PTransactions()" style="padding: 0.6rem; display:inline-block; width:auto;">
                                <option value="all">All</option>
                                <option value="awaiting_payment">Awaiting Payment</option>
                                <option value="payment_proof_submitted">Proof Submitted</option>
                                <option value="disputed">Disputed</option>
                                <option value="resolved_by_admin">Resolved by Admin</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                                <option value="cancelled_by_admin">Cancelled by Admin</option>
                            </select>
                        </div>
                        <button onclick="clearP2PTransactionLogs()" class="danger"><i class="fas fa-trash-alt"></i> Clear All Logs</button>
                    </div>
                    <div id="admin-p2p-transactions-area" class="data-table-wrapper">
                        <p class="loading-text">Loading transactions...</p>
                    </div>
                </div>
                <div id="ad-user-assets" class="dashboard-card hidden">
                    <h3><i class="fas fa-chart-line"></i> All User Assets</h3>
                    <div id="admin-user-assets-area" class="data-table-wrapper">
                       <p>No assets found in the system.</p>
                    </div>
                </div>
                <div id="ad-support-tickets" class="dashboard-card hidden">
                    <h3><i class="fas fa-life-ring"></i> All Support Tickets</h3>
                     <div id="admin-tickets-list" class="data-table-wrapper">
                       <p>No support tickets found.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="ticket-details-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-button" onclick="closeTicketDetailsModal()">×</span>
            <h3 id="ticket-details-subject">Ticket Subject</h3>
            <p><small>Ticket ID: <span id="ticket-details-id"></span> | Status: <span id="ticket-details-status" style="text-transform:capitalize;"></span></small></p>
            <hr>
            <div id="ticket-messages-container" style="max-height: 300px; overflow-y: auto; margin-bottom:1rem;">
                <!-- Messages will be populated here -->
            </div>
            <div id="ticket-reply-area" class="ticket-reply-area">
                <h4>Reply to Ticket</h4>
                <textarea id="ticket-reply-message" rows="3" placeholder="Your reply..."></textarea>
                <button onclick="submitTicketReply()" class="accent"><i class="fas fa-paper-plane"></i> Send Reply</button>
                <button class="secondary" id="ticket-modal-status-button">Mark as ...</button> <!-- Onclick handled by JS -->
            </div>
        </div>
    </div>

    <div id="admin-edit-kyc-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-button" onclick="closeAdminEditKycModal()">×</span>
            <h3 id="admin-edit-kyc-modal-title">Edit User KYC Details</h3>
            <input type="hidden" id="admin-edit-kyc-userId">
            <div>
                <label for="admin-kyc-bank-name"><i class="fas fa-university"></i> Bank Name:</label>
                <input type="text" id="admin-kyc-bank-name">
                <label for="admin-kyc-bank-account"><i class="fas fa-hashtag"></i> Bank Account:</label>
                <input type="text" id="admin-kyc-bank-account">
                <label for="admin-kyc-usdt-wallet"><i class="fab fa-bitcoin"></i> USDT Wallet:</label>
                <input type="text" id="admin-kyc-usdt-wallet">
                <label for="admin-kyc-telephone"><i class="fas fa-phone"></i> Telephone:</label>
                <input type="text" id="admin-kyc-telephone">
                <label for="admin-kyc-country"><i class="fas fa-globe"></i> Country:</label>
                <select id="admin-kyc-country"></select>
                <label for="admin-kyc-status"><i class="fas fa-user-check"></i> KYC Status:</label>
                <select id="admin-kyc-status">
                    <option value="none">None</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                </select>
                <div id="admin-kyc-rejection-reason-group" class="hidden">
                    <label for="admin-kyc-rejection-reason">Rejection Reason:</label>
                    <textarea id="admin-kyc-rejection-reason" rows="3"></textarea>
                </div>
                <div style="margin-top: 1rem; margin-bottom: 1rem; padding: 0.5rem; background-color: #f0f0f0; border-radius: 4px;">
                     <label for="admin-kyc-p2p-bypass" style="display: flex; align-items: center; margin-bottom: 0;">
                        <input type="checkbox" id="admin-kyc-p2p-bypass" style="width: auto; margin-right: 10px; margin-bottom: 0;"> 
                        <span style="font-weight: normal;">Bypass initial seller purchase requirement for P2P access</span>
                    </label>
                </div>
                 <p id="admin-kyc-doc-display" style="margin-top:0.5rem; margin-bottom:0.5rem;">Current Document: None</p>
                 <label for="admin-kyc-new-document"><i class="fas fa-file-upload"></i> Upload New Document (Optional - replaces existing):</label>
                 <input type="file" id="admin-kyc-new-document" accept="image/*,.pdf">
                <button onclick="saveAdminKycChanges()" class="accent" style="margin-top:1rem;"><i class="fas fa-save"></i> Save KYC Changes</button>
            </div>
        </div>
    </div>
    
    <div id="admin-repackage-p2p-offer-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-button" onclick="closeAdminRepackageP2POfferModal()">×</span>
            <h3>Repackage P2P Offer</h3>
            <p>Set new terms for this user's offer. The original coins will be used, but new buyers will see these terms.</p>
            <input type="hidden" id="admin-repackage-p2p-offer-id">
            
            <div id="admin-repackage-p2p-original-details" style="background-color: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <!-- Original offer details will be populated here -->
            </div>

            <label for="admin-repackage-plan-name">New Plan Name:</label>
            <input type="text" id="admin-repackage-plan-name" placeholder="e.g., Premium P2P Growth" style="margin-bottom: 1rem;">
            
            <label for="admin-repackage-price">New Selling Price per COIN:</label>
            <div class="form-inline-group" style="display: flex; gap: 1rem; align-items: flex-end;">
                <div style="flex-grow:1;">
                    <input type="number" id="admin-repackage-price" placeholder="e.g. 2.00" style="margin-bottom:0;">
                </div>
                <select id="admin-repackage-currency" style="margin-bottom:0;">
                    <option value="USD">USD</option>
                    <option value="ZAR">ZAR</option>
                    <option value="BTC">BTC</option>
                </select>
            </div>
            
            <div class="form-inline-group" style="display: flex; gap: 1rem; margin-top: 1rem;">
                <div style="flex-grow:1;">
                    <label for="admin-repackage-return">New Return Percentage (%):</label>
                    <input type="number" id="admin-repackage-return" placeholder="e.g., 25 for 25%">
                </div>
                <div style="flex-grow:1;">
                     <label for="admin-repackage-maturity-value">New Maturity Duration:</label>
                    <div class="form-inline-group" style="display: flex; gap: 0.5rem; align-items: center;">
                        <input type="number" id="admin-repackage-maturity-value" placeholder="e.g., 14" style="margin-bottom:0; flex-grow: 1;">
                        <select id="admin-repackage-maturity-unit" style="margin-bottom:0; flex-grow: 1;">
                            <option value="Days">Days</option>
                            <option value="Hours">Hours</option>
                            <option value="Minutes">Minutes</option>
                        </select>
                    </div>
                </div>
            </div>
            <div>
            <button onclick="saveAdminRepackageP2POffer()" class="accent" style="margin-top:1.5rem; width:100%;"><i class="fas fa-save"></i> Save Repackaged Offer</button>
        </div>
    <!--</div>
       <button onclick="saveAdminRepackageP2POffer()" class="accent" style="margin-top:1.5rem; width:100%;"><i class="fas fa-save"></i> Save Repackaged Offer</button>
        </div>
    </div>-->

    <div id="proof-viewer-modal" class="modal">
        <div class="modal-content" style="padding: 1rem; max-width: 90vw; width: auto; background: transparent; box-shadow: none;">
             <span class="close-modal-button" onclick="closeProofViewerModal()" style="color:white; font-size:40px; top:20px; right:35px;">×</span>
             <img id="proof-viewer-image" style="max-width: 100%; max-height: 85vh; display: block; margin: auto; border-radius: 8px; background-color: white;">
             <p id="proof-viewer-caption" style="text-align:center; color:white; margin-top:1rem; font-weight: 500;"></p>
        </div>
    </div>

    <footer >
        <p>© <span id="currentYear"></span> P2P Reform Business. All Rights Reserved.</p>
        
    </footer>

    <script src="script.js" defer></script>
</body>
</html>
