<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P Reform Business</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
    <!-- Chart.js and jsPDF CDNs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf-plugin-autotable.min.js"></script>
</head>
<body>
    <nav class="main-nav">
        <div class="logo" onclick="handleLogoClick();"><i class="fas fa-chart-line"></i><span>P</span>P2P Reform</div>
        <ul id="nav-links">
            <li><a href="#" onclick="switchView('landing-page-view'); setActiveLink(this); return false;"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="#" onclick="switchView('about-view'); setActiveLink(this); return false;"><i class="fas fa-info-circle"></i> About</a></li>
            <li class="hidden"><button onclick="handleDashboardNavClick();" id="nav-dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</button></li>
            <li><a href="#" onclick="switchView('login-form-view'); setActiveLink(this); return false;" id="nav-login"><i class="fas fa-sign-in-alt"></i> Login</a></li>
            <li><a href="#" onclick="switchView('register-form-view'); setActiveLink(this); return false;" id="nav-register" class="nav-button-special"><i class="fas fa-user-plus"></i> Register</a></li>
            <li id="notification-bell-item" class="hidden" style="position:relative;">
                <button id="notification-bell-button" onclick="toggleNotificationPanel()">
                    <i class="fas fa-bell"></i>
                    <span id="unread-notification-count" class="hidden">0</span>
                </button>
                <div id="notification-panel" class="hidden">
                    <div id="notification-panel-list">
                        <p class="no-notifications">No new notifications.</p>
                    </div>
                </div>
            </li>
            <li class="hidden"><button onclick="handleLogout()" id="nav-logout"><i class="fas fa-sign-out-alt"></i> Logout</button></li>
        </ul>
    </nav>

    <div id="popup-notification-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-button" onclick="closePopupNotificationModal()">×</span>
            <h3 id="popup-notification-title">Notification</h3>
            <p id="popup-notification-message"></p>
            <button onclick="closePopupNotificationModal()" class="button accent">OK</button>
        </div>
    </div>

    <div id="custom-confirm-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-button" onclick="closeCustomConfirmModal(false)">×</span>
            <h3 id="custom-confirm-title">Confirmation</h3>
            <p id="custom-confirm-message"></p>
            <div style="text-align: right; margin-top: 1.5rem;">
                <button onclick="closeCustomConfirmModal(false)" class="button secondary">Cancel</button>
                <button onclick="closeCustomConfirmModal(true)" class="button" id="custom-confirm-ok-button">OK</button>
            </div>
        </div>
    </div>

    <div id="custom-prompt-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-button" onclick="closeCustomPromptModal(null)">×</span>
            <h3 id="custom-prompt-title">Input Required</h3>
            <p id="custom-prompt-message"></p>
            <input type="text" id="custom-prompt-input" style="margin-top: 0.5rem; margin-bottom: 1rem;">
            <div style="text-align: right; margin-top: 1.5rem;">
                <button onclick="closeCustomPromptModal(null)" class="button secondary">Cancel</button>
                <button onclick="closeCustomPromptModal(true)" class="button accent" id="custom-prompt-ok-button">Submit</button>
            </div>
        </div>
    </div>

    <div id="landing-page-view">
        <section class="hero-section">
            <video autoplay muted loop id="hero-video">
                <!-- Find a suitable stock video. This is a placeholder. -->
                <source src="https://assets.mixkit.co/videos/preview/mixkit-abstract-3d-background-and-sphere-of-flowing-lines-39904-large.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <div class="hero-overlay"></div>
            <div class="hero-content animate-on-scroll fade-in-up">
                <h1>The Future of Secure <br>P2P Asset Exchange</h1>
                <p>Your trusted platform for P2P coin exchange and profitable digital asset investments. Experience seamless, secure trading with global currency options.</p>
                <a href="#" onclick="switchView('register-form-view'); setActiveLink(document.getElementById('nav-register')); return false;" class="cta-button">
                    <i class="fas fa-rocket"></i> Get Started Now
                </a>
            </div>
        </section>

        <div class="features-overview">
            <h2 class="animate-on-scroll fade-in-up">Platform Highlights</h2>
            <p class="section-subtitle animate-on-scroll fade-in-up" data-delay="1">Empowering your financial journey with state-of-the-art tools and security.</p>
            <div class="info-grid">
                <div class="info-card animate-on-scroll fade-in-up" data-delay="2">
                    <i class="fas fa-exchange-alt"></i>
                    <strong>Multi-Currency P2P</strong>
                    <span>Trade COINs for USD, ZAR, or BTC directly with peers.</span>
                </div>
                <div class="info-card animate-on-scroll fade-in-up" data-delay="3">
                    <i class="fas fa-store"></i>
                    <strong>System Coin Sales</strong>
                    <span>Purchase COINs directly from the Seller via special sale plans.</span>
                </div>
                <div class="info-card animate-on-scroll fade-in-up" data-delay="4">
                    <i class="fas fa-piggy-bank"></i>
                    <strong>Investment Programs</strong>
                    <span>Grow your COIN holdings with our structured investment plans.</span>
                </div>
                 <div class="info-card animate-on-scroll fade-in-up" data-delay="5">
                    <i class="fas fa-user-shield"></i>
                    <strong>Secure Dashboard</strong>
                    <span>Track your assets, trades, and investments with institutional-grade security.</span>
                </div>
            </div>
        </div>
        
        <section class="how-it-works-section">
             <h2 class="animate-on-scroll fade-in-up">Simple Steps to Success</h2>
             <p class="section-subtitle animate-on-scroll fade-in-up" data-delay="1">Start your investment journey in just a few clicks.</p>
             <div class="steps-container">
                 <div class="step-card animate-on-scroll slide-in-left" data-delay="2">
                     <div class="step-icon"><i class="fas fa-user-plus"></i></div>
                     <h3>1. Create Account</h3>
                     <p>Register in minutes and create your secure digital wallet.</p>
                 </div>
                 <div class="step-arrow"><i class="fas fa-arrow-right"></i></div>
                 <div class="step-card animate-on-scroll fade-in-up" data-delay="3">
                     <div class="step-icon"><i class="fas fa-shield-alt"></i></div>
                     <h3>2. Get Verified</h3>
                     <p>Complete our fast and secure KYC process to unlock all features.</p>
                 </div>
                 <div class="step-arrow"><i class="fas fa-arrow-right"></i></div>
                 <div class="step-card animate-on-scroll slide-in-right" data-delay="4">
                     <div class="step-icon"><i class="fas fa-coins"></i></div>
                     <h3>3. Fund & Invest</h3>
                     <p>Purchase COINs, explore the P2P market, and start investing.</p>
                 </div>
             </div>
        </section>
    </div>

    <div id="about-view" class="main-content hidden">
        <div class="dashboard-card">
            <h3><i class="fas fa-info-circle"></i> About P2P Reform Business</h3>
            <p>P2P Reform Business is dedicated to revolutionizing how individuals interact with digital assets. Our platform provides a secure, transparent, and user-centric environment for peer-to-peer trading and strategic investments.</p>
            <p>Key features include a versatile P2P marketplace supporting various fiat currencies (USD, ZAR) and Bitcoin (BTC) for pricing COINs, alongside structured investment programs designed for asset growth. Additionally, users can purchase COINs directly from the system during admin-managed sale events. We simulate robust security measures, including escrow services and payment proof verification, to foster trust and safety within our community.</p>
            <p><em>Disclaimer: This platform is a demonstration project. No real financial transactions occur, and any resemblance to actual financial services is purely for illustrative purposes. Do not use real financial information.</em></p>
        </div>
    </div>

    <div id="register-form-view" class="form-view-container hidden">
        <div class="form-section">
            <h2 style="text-align: center;"><i class="fas fa-user-plus"></i> Create Your Account</h2>
            <label for="reg-name"><i class="fas fa-user"></i> Full Name:</label>
            <input type="text" id="reg-name" placeholder="Full Name">
            <label for="reg-email"><i class="fas fa-envelope"></i> Email:</label>
            <input type="email" id="reg-email" placeholder="Email address">
            <label for="reg-password"><i class="fas fa-lock"></i> Password:</label>
            <div class="password-field-container">
                <input type="password" id="reg-password" placeholder="Create a password">
            </div>
            <label class="show-password-label">
                <input type="checkbox" onclick="togglePasswordVisibility('reg-password')"> Show Password
            </label>
            <button onclick="handleRegister()" class="accent" style="width:100%; margin-top: 1.5rem;"><i class="fas fa-check-circle"></i> Register</button>
            <p style="text-align:center; margin-top:1rem; font-size:0.9rem;">Already have an account? <a href="#" onclick="switchView('login-form-view'); setActiveLink(document.getElementById('nav-login')); return false;">Login here</a></p>
        </div>
    </div>

    <div id="login-form-view" class="form-view-container hidden">
        <div class="form-section">
            <h2 style="text-align: center;"><i class="fas fa-sign-in-alt"></i> Welcome Back!</h2>
            <label for="login-email"><i class="fas fa-envelope"></i> Email:</label>
            <input type="email" id="login-email" placeholder="Your email address">
            <label for="login-password"><i class="fas fa-lock"></i> Password:</label>
             <div class="password-field-container">
                <input type="password" id="login-password" placeholder="Your password">
            </div>
            <label class="show-password-label">
                <input type="checkbox" onclick="togglePasswordVisibility('login-password')"> Show Password
            </label>
            <button onclick="handleLogin()" class="accent" style="width:100%; margin-top: 1.5rem;"><i class="fas fa-arrow-right"></i> Login</button>
            <p style="text-align:center; margin-top:1rem; font-size:0.9rem;">New user? <a href="#" onclick="switchView('register-form-view'); setActiveLink(document.getElementById('nav-register')); return false;">Create an account</a></p>
        </div>
    </div>

    <div id="user-dashboard-view" class="main-content hidden">
        <div class="dashboard-header-simple">
            <h2 id="user-welcome-message"></h2>
        </div>
        <div class="dashboard-layout">
            <aside class="dashboard-sidebar">
                <h3><i class="fas fa-compass"></i> Navigation</h3>
                <ul>
                    <li><button class="active" onclick="showUserDashboardSection('ud-overview', this)"><i class="fas fa-wallet"></i> Overview & Wallet</button></li>
                    <li><button onclick="showUserDashboardSection('ud-kyc', this)"><i class="fas fa-user-shield"></i> KYC Verification</button></li>
                    <li><button onclick="showUserDashboardSection('ud-system-sale', this)"><i class="fas fa-store"></i> System Coin Sale</button></li>
                    <li><button onclick="showUserDashboardSection('ud-p2p-market', this)"><i class="fas fa-exchange-alt"></i> P2P Market</button></li>
                    <li><button onclick="showUserDashboardSection('ud-pending-transactions', this)"><i class="fas fa-hourglass-half"></i> Pending Transactions</button></li>
                    <li><button onclick="showUserDashboardSection('ud-p2p-history', this)"><i class="fas fa-history"></i> P2P History</button></li>
                    <li><button onclick="showUserDashboardSection('ud-investments', this)"><i class="fas fa-piggy-bank"></i> Investments</button></li>
                    <li><button onclick="showUserDashboardSection('ud-withdraw-funds', this)"><i class="fas fa-money-bill-wave"></i> Withdraw Funds</button></li>
                    <li><button onclick="showUserDashboardSection('ud-support-tickets', this)"><i class="fas fa-life-ring"></i> Support Tickets</button></li>
                </ul>
            </aside>
            <main class="dashboard-main-content">
                <div id="ud-overview" class="dashboard-card">
                    <h3><i class="fas fa-chart-pie"></i> Account Overview</h3>
                    <div class="info-grid" style="grid-template-columns: 1fr;">
                        <div class="info-card" id="user-coin-balance-card"><strong><i class="fas fa-coins"></i> Coin Balance</strong><span id="coin-balance">0</span> COIN</div>
                    </div>
                     <div id="wallet-balances-grid" class="info-grid" style="margin-top: 1.5rem;">
                        <!-- Wallet balances will be populated here by JS -->
                    </div>
                    <div id="coin-chart-container" style="margin-top: 1.5rem;"> <canvas id="userCoinChart"></canvas> </div>
                    <button onclick="toggleUserProfileDetails()" id="toggle-profile-details-btn" class="button secondary" style="margin-top:1.5rem;"><i class="fas fa-user-circle"></i> Show Full Profile Details</button>
                    <div id="user-profile-details-collapsible" class="hidden">
                        <h4 style="margin-top:0; margin-bottom:1rem; padding-bottom:0.5rem; border-bottom: 1px solid var(--border-color)">Full Profile Details</h4>
                        <div class="info-grid">
                            <div class="info-card"><strong><i class="fas fa-envelope"></i> Email</strong><span id="profile-email"></span></div>
                            <div class="info-card"><strong><i class="fas fa-user-check"></i> KYC Status</strong><span id="profile-kyc-status" style="text-transform: capitalize;"></span></div>
                            <div class="info-card"><strong><i class="fas fa-university"></i> Bank Name</strong><span id="profile-bank-name"></span></div>
                            <div class="info-card"><strong><i class="fas fa-hashtag"></i> Bank Account</strong><span id="profile-bank-account"></span></div>
                            <div class="info-card"><strong><i class="fab fa-bitcoin"></i> USDT Wallet</strong><span id="profile-usdt-wallet"></span></div>
                            <div class="info-card"><strong><i class="fas fa-phone"></i> Telephone</strong><span id="profile-telephone"></span></div>
                            <div class="info-card"><strong><i class="fas fa-globe"></i> Country</strong><span id="profile-country"></span></div>
                        </div>
                    </div>
                </div>
                <div id="ud-kyc" class="dashboard-card hidden">
                    <h3><i class="fas fa-user-shield"></i> KYC Verification</h3>
                    <div id="kyc-status-display" style="margin-bottom: 1rem;">
                        <p>Your current KYC status is: <strong id="kyc-current-status-text" style="text-transform: capitalize;">Not Submitted</strong></p>
                        <p id="kyc-rejection-reason" class="hidden" style="padding:0.5rem; color: var(--danger-color); border: 1px solid var(--danger-color); border-radius:4px; background-color: #ffebee;"></p>
                    </div>
                    <div id="kyc-form-area">
                        <p id="kyc-form-instructions">Please fill out your details below and upload a verification document (e.g., ID, Passport). You can update these details at any time, which may require re-verification.</p>
                        <label for="kyc-bank-name"><i class="fas fa-university"></i> Bank Name:</label>
                        <input type="text" id="kyc-bank-name" placeholder="Your Bank Name">
                        <label for="kyc-bank-account"><i class="fas fa-hashtag"></i> Bank Account Number:</label>
                        <input type="text" id="kyc-bank-account" placeholder="Your Bank Account Number">
                        <label for="kyc-usdt-wallet"><i class="fab fa-bitcoin"></i> USDT Wallet Address (TRC20/ERC20):</label>
                        <input type="text" id="kyc-usdt-wallet" placeholder="Your USDT Wallet Address">
                        <label for="kyc-telephone"><i class="fas fa-phone"></i> Telephone Number (with country code):</label>
                        <input type="text" id="kyc-telephone" placeholder="+1234567890">
                        <label for="kyc-country"><i class="fas fa-globe"></i> Country of Residence:</label>
                        <select id="kyc-country"></select>
                        <label for="kyc-document"><i class="fas fa-id-card"></i> Upload Verification Document:</label>
                        <input type="file" id="kyc-document" accept="image/*,.pdf">
                        <p id="kyc-uploaded-file-name" style="font-size:0.85rem; margin-top:-0.5rem; margin-bottom:1rem;"></p>
                        <button onclick="submitKycForm()" class="accent" id="submit-kyc-button"><i class="fas fa-paper-plane"></i> Submit/Update KYC Information</button>
                    </div>
                    <div id="kyc-pending-approval-area" class="hidden" style="padding:1rem; background-color: #E1F5FE; border-left: 4px solid var(--accent-color); color: var(--primary-color);">
                        <p><i class="fas fa-hourglass-start"></i> Your KYC information has been submitted and is pending approval. You will be notified once it's reviewed.</p>
                    </div>
                     <div id="kyc-approved-area" class="hidden" style="padding:1rem; background-color: #E8F5E9; border-left: 4px solid var(--success-color); color: var(--primary-color);">
                        <p><i class="fas fa-check-circle"></i> Your KYC information has been approved! You now have full access to platform features.</p>
                        <p id="kyc-approved-update-info" class="hidden" style="font-size:0.9rem; margin-top:0.5rem;">To request an update to your KYC details, please contact support.</p>
                    </div>
                </div>
                <div id="ud-system-sale" class="dashboard-card hidden">
                    <h3><i class="fas fa-store"></i> System Coin Sale</h3>
                    <p id="system-sale-initial-purchase-message" class="hidden" style="padding:1rem; background-color: #E1F5FE; border-left: 4px solid var(--accent-color); color: var(--primary-color);">
                        Welcome! To unlock all platform features, including the P2P market, please make your first COIN purchase from one of the system plans below.
                    </p>
                    <p id="countdown-timer-container">System Sale Status: <span id="countdown-timer" style="font-weight:bold;">Loading...</span></p>
                    <div id="system-sale-plans-area" class="hidden">
                        <h4>Available Purchase Plans from Seller (8% COIN Bonus on all plans!)</h4>
                        <div id="user-system-sale-plans-list"></div>
                         <hr style="margin: 1.5rem 0;">
                        <h4>Or Buy from P2P Market:</h4>
                        <div id="system-sale-p2p-offers-list">
                            <p class="loading-text">Loading P2P offers...</p>
                        </div>
                    </div>
                    <div id="system-sale-user-pending-message" class="hidden"></div>
                </div>
                <!-- ##### MODIFIED SECTION START ##### -->
                <div id="ud-p2p-market" class="dashboard-card hidden">
                    <h3><i class="fas fa-exchange-alt"></i> P2P Market: Buy & Sell COINs</h3>
                    <div id="p2p-market-disabled-message" class="hidden" style="padding:1rem; background-color: #FFF3E0; border-left: 4px solid var(--warning-color); color: var(--text-dark); margin-bottom: 1rem;">
                        <i class="fas fa-lock"></i> P2P market features are enabled after your first COIN purchase from a System Sale Plan.
                    </div>
                    <div class="form-section" style="padding:1rem; margin-bottom: 1.5rem;">
                        <h4>Create Sell Offer</h4>
                        <p id="p2p-sell-offer-info-text" style="font-size:0.85rem; margin-bottom:1rem;">Enter the amount of COIN to sell. The price is fixed at 2x your last system purchase price.</p>
                        <div class="form-inline-group">
                            <div>
                                <label for="sell-offer-amount"><i class="fas fa-coins"></i> Amount (COIN) to Sell:</label>
                                <input type="number" id="sell-offer-amount" placeholder="e.g. 100">
                            </div>
                            <button onclick="createSellOffer()" class="accent" id="create-sell-offer-button" style="align-self: flex-end; margin-bottom: 1rem;"><i class="fas fa-plus-circle"></i> Create Offer</button>
                        </div>
                    </div>
                    <h4>My Active & Past Sell Offers</h4>
                    <div id="my-sell-offers-list" class="data-table-wrapper" style="margin-bottom: 2rem;">
                        <p>You have not created any sell offers.</p>
                    </div>
                    <h4>Available Offers from Other Users</h4>
                    <div id="available-offers-list">
                        <p class="loading-text">No offers available at the moment.</p>
                    </div>
                </div>
                <!-- ##### MODIFIED SECTION END ##### -->
                <div id="ud-pending-transactions" class="dashboard-card hidden">
                    <h3><i class="fas fa-hourglass-half"></i> My Pending Transactions</h3>
                    <div id="pending-transactions-list"> <p>No pending transactions.</p> </div>
                </div>
                <div id="ud-p2p-history" class="dashboard-card hidden">
                    <h3><i class="fas fa-history"></i> My P2P Transaction History</h3>
                    <button onclick="exportP2PTransactionHistoryPDF()" class="secondary" style="float:right; margin-bottom:1rem;"><i class="fas fa-file-pdf"></i> Export PDF</button>
                    <div id="p2p-history-list" class="data-table-wrapper">
                        <p>No completed P2P transactions.</p>
                    </div>
                </div>
                <div id="ud-investments" class="dashboard-card hidden">
                    <h3><i class="fas fa-piggy-bank"></i> COIN Investment Program</h3>
                    <p>Invest 1000 COIN for 7 days to get 3000 COIN back. Fixed term, fixed amount.</p>
                    <button onclick="handleInvestment()" class="accent"><i class="fas fa-rocket"></i> Invest 1000 COIN</button>
                    <h4 style="margin-top: 1.5rem;">My Active & Matured Investments</h4>
                    <div id="active-investments-list">
                        <p>No active investments.</p>
                    </div>
                </div>
                <div id="ud-withdraw-funds" class="dashboard-card hidden">
                    <h3><i class="fas fa-money-bill-wave"></i> Withdraw Funds</h3>
                    <div class="form-section" style="padding:1rem; margin-bottom: 2rem;">
                        <h4>Request a Withdrawal</h4>
                        <p>Withdrawals are processed by admin within 48 hours (simulated). Funds will be sent to your KYC-verified bank/BTC account.</p>
                        <label for="withdraw-currency"><i class="fas fa-dollar-sign"></i> Select Currency to Withdraw:</label>
                        <select id="withdraw-currency">
                            <option value="USD">USD Wallet</option>
                            <option value="ZAR">ZAR Wallet</option>
                            <option value="BTC">BTC Wallet</option>
                        </select>
                        <label for="withdraw-amount"><i class="fas fa-calculator"></i> Amount to Withdraw:</label>
                        <input type="number" id="withdraw-amount" placeholder="0.00">
                        <div id="withdraw-destination-details" style="margin-top:0.5rem; margin-bottom:1rem; font-size:0.9rem; background-color: #f0f0f0; padding:0.5rem; border-radius:4px;">
                            <p><strong><i class="fas fa-map-marker-alt"></i> Destination:</strong> <span id="withdraw-destination-info">Please select currency.</span></p>
                        </div>
                        <button onclick="handleWithdrawalRequest()" class="accent"><i class="fas fa-paper-plane"></i> Submit Withdrawal Request</button>
                    </div>
                    <h4>My Withdrawal History</h4>
                    <div id="user-withdrawal-history-list" class="data-table-wrapper">
                        <p>You have no withdrawal requests yet.</p>
                    </div>
                </div>
                 <div id="ud-support-tickets" class="dashboard-card hidden">
                    <h3><i class="fas fa-life-ring"></i> Support Tickets</h3>
                    <div class="form-section" style="padding:1rem; margin-bottom: 2rem;">
                        <h4>Create New Ticket</h4>
                        <label for="ticket-subject"><i class="fas fa-heading"></i> Subject:</label>
                        <input type="text" id="ticket-subject" placeholder="e.g., KYC Update Request">
                        <label for="ticket-message"><i class="fas fa-comment-dots"></i> Message:</label>
                        <textarea id="ticket-message" rows="4" placeholder="Describe your issue or request..."></textarea>
                        <button onclick="createNewSupportTicket()" class="accent"><i class="fas fa-paper-plane"></i> Submit Ticket</button>
                    </div>
                    <h4>My Tickets</h4>
                    <div id="user-tickets-list" class="data-table-wrapper">
                        <p>You have not created any support tickets yet.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="admin-dashboard-view" class="main-content hidden">
         <div class="dashboard-header-simple">
            <h2 style="margin:0;"><i class="fas fa-user-cog"></i> Administrator Panel</h2>
        </div>
        <div class="dashboard-layout">
            <aside class="dashboard-sidebar">
                 <h3><i class="fas fa-bars"></i> Admin Menu</h3>
                <ul>
                    <li><button class="active" onclick="showAdminDashboardSection('ad-overview', this)"><i class="fas fa-tachometer-alt"></i> Overview & Stats</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-users', this)"><i class="fas fa-users"></i> User Management</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-kyc-requests', this)"><i class="fas fa-user-shield"></i> KYC Requests</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-withdrawal-requests', this)"><i class="fas fa-hand-holding-usd"></i> Withdrawal Requests</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-system-sale-config', this)"><i class="fas fa-cogs"></i> System Config</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-system-sale-requests', this)"><i class="fas fa-file-invoice-dollar"></i> System Sale Requests</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-p2p-tx', this)"><i class="fas fa-exchange-alt"></i> P2P Transactions</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-investments', this)"><i class="fas fa-chart-line"></i> All Investments</button></li>
                    <li><button onclick="showAdminDashboardSection('ad-support-tickets', this)"><i class="fas fa-life-ring"></i> Support Tickets</button></li>
                </ul>
            </aside>
            <main class="dashboard-main-content">
                <div id="ad-overview" class="dashboard-card">
                    <h3><i class="fas fa-chart-bar"></i> Admin Overview & Stats</h3>
                    <div class="info-grid">
                        <div class="info-card"><strong><i class="fas fa-users"></i> Total Users</strong><span id="admin-stat-total-users">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-coins"></i> Total COINs in Circulation</strong><span id="admin-stat-total-coins">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-chart-line"></i> COINs in Active Investments</strong><span id="admin-stat-active-investments">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-user-clock"></i> Pending KYC Requests</strong><span id="admin-stat-pending-kyc">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-hourglass-half"></i> Pending P2P Transactions</strong><span id="admin-stat-pending-p2p">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-shopping-cart"></i> Pending System Purchases</strong><span id="admin-stat-pending-system-purchases">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-hand-holding-usd"></i> Pending Withdrawals</strong><span id="admin-stat-pending-withdrawals">0</span></div>
                        <div class="info-card"><strong><i class="fas fa-envelope-open-text"></i> Open Support Tickets</strong><span id="admin-stat-open-support-tickets">0</span></div>
                    </div>
                </div>
                <div id="ad-users" class="dashboard-card hidden">
                    <h3><i class="fas fa-users"></i> User Management</h3>
                     <div style="margin-bottom: 1rem;">
                        <input type="text" id="admin-user-search" placeholder="Search by name, email, or ID..." onkeyup="renderAdminUserList()" style="max-width: 300px;">
                    </div>
                    <div id="admin-user-list-area" class="data-table-wrapper">
                        <p class="loading-text">Loading users...</p>
                    </div>
                </div>
                <div id="ad-kyc-requests" class="dashboard-card hidden">
                    <h3><i class="fas fa-user-shield"></i> KYC Verification Requests</h3>
                    <div id="admin-kyc-requests-list" class="data-table-wrapper">
                        <p>No pending KYC requests.</p>
                    </div>
                </div>
                <div id="ad-withdrawal-requests" class="dashboard-card hidden">
                    <h3><i class="fas fa-hand-holding-usd"></i> User Withdrawal Requests</h3>
                    <div id="admin-withdrawal-requests-list" class="data-table-wrapper">
                        <p>No withdrawal requests found.</p>
                    </div>
                </div>
                <div id="ad-system-sale-config" class="dashboard-card hidden">
                    <h3><i class="fas fa-cogs"></i> System Configuration</h3>
                     <div class="form-section" style="padding: 1rem; margin-bottom:1.5rem;">
                        <h4>Default System Currency</h4>
                        <label for="admin-default-currency">Set Default Currency for P2P & New Plans:</label>
                        <select id="admin-default-currency">
                            <option value="USD">USD</option>
                            <option value="ZAR">ZAR</option>
                            <option value="BTC">BTC</option>
                        </select>
                        <button onclick="saveDefaultSystemCurrency()" class="accent"><i class="fas fa-save"></i> Save Default Currency</button>
                        <p style="font-size:0.85rem; margin-top:0.5rem;">Current Default: <strong id="current-default-system-currency-display">USD</strong></p>
                    </div>
                    <div class="form-section" style="padding: 1rem; margin-bottom:1.5rem;">
                        <h4>Sale Timers</h4>
                        <label for="admin-sale-duration">Sale Duration (seconds):</label>
                        <input type="number" id="admin-sale-duration" placeholder="e.g., 300 for 5 mins">
                        <label for="admin-cooldown-duration">Cooldown Between Sales (seconds):</label>
                        <input type="number" id="admin-cooldown-duration" placeholder="e.g., 60 for 1 min">
                        <button onclick="saveSystemSaleTimers()" class="accent"><i class="fas fa-save"></i> Save Timers</button>
                    </div>
                    <div class="form-section" style="padding: 1rem;">
                        <form id="plan-form">
                            <h4>Manage Sale Plans (All plans offer an 8% COIN bonus)</h4>
                            <div style="border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom:1rem;">
                                <h5>Add New Plan / Edit Plan <small id="editing-plan-id" class="hidden">(Editing ID: <span></span>)</small></h5>
                                <label for="plan-name">Plan Name:</label>
                                <input type="text" id="plan-name" placeholder="e.g., Starter Pack">
                                <div class="form-inline-group">
                                    <div>
                                        <label for="plan-cost">Cost:</label>
                                        <input type="number" id="plan-cost" placeholder="e.g., 20">
                                    </div>
                                    <select id="plan-currency">
                                        <option value="USD">USD</option>
                                        <option value="ZAR">ZAR</option>
                                        <option value="BTC">BTC</option>
                                    </select>
                                </div>
                                <label for="plan-coins-awarded">Base Coins Awarded (before 8% bonus):</label>
                                <input type="number" id="plan-coins-awarded" placeholder="e.g., 40">
                                <label for="plan-bank-name">Seller Bank Name (for this plan):</label>
                                <input type="text" id="plan-bank-name" placeholder="e.g., Seller Bank Inc.">
                                <label for="plan-bank-account">Seller Bank Account No.:</label>
                                <input type="text" id="plan-bank-account" placeholder="e.g., 987654321">
                                <label for="plan-btc-wallet">Seller BTC Wallet:</label>
                                <input type="text" id="plan-btc-wallet" placeholder="Seller Bitcoin Address for this plan">
                                <button type="button" onclick="handleAddOrUpdateSystemSalePlan()" class="accent" id="add-plan-button"><i class="fas fa-plus"></i> Add Plan</button>
                                <button type="button" onclick="clearPlanEditForm()" class="secondary hidden" id="cancel-edit-plan-button"><i class="fas fa-times"></i> Cancel Edit</button>
                            </div>
                        </form>
                        <h5>Existing Plans</h5>
                        <div id="admin-system-sale-plans-list" class="data-table-wrapper">
                            <p>No plans defined yet.</p>
                        </div>
                    </div>
                </div>
                <div id="ad-system-sale-requests" class="dashboard-card hidden">
                    <h3><i class="fas fa-file-invoice-dollar"></i> System Coin Purchase Requests from Users</h3>
                    <button onclick="clearSystemSaleRequestsLogs()" class="danger" style="float:right; margin-bottom:1rem;"><i class="fas fa-trash-alt"></i> Clear All Logs</button>
                    <div id="admin-system-purchase-requests-list" class="data-table-wrapper">
                        <p>No pending system purchase requests.</p>
                    </div>
                </div>
                <div id="ad-p2p-tx" class="dashboard-card hidden">
                     <h3><i class="fas fa-exchange-alt"></i> P2P Transactions</h3>
                     <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 1rem;">
                        <div>
                            <label for="admin-p2p-filter-status" style="margin-right: 0.5rem; display:inline-block;">Filter by Status:</label>
                            <select id="admin-p2p-filter-status" onchange="renderAdminP2PTransactions()" style="padding: 0.6rem; display:inline-block; width:auto;">
                                <option value="all">All</option>
                                <option value="awaiting_payment">Awaiting Payment</option>
                                <option value="payment_proof_submitted">Proof Submitted</option>
                                <option value="disputed">Disputed</option>
                                <option value="resolved_by_admin">Resolved by Admin</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                                <option value="cancelled_by_admin">Cancelled by Admin</option>
                            </select>
                        </div>
                        <button onclick="clearP2PTransactionLogs()" class="danger"><i class="fas fa-trash-alt"></i> Clear All Logs</button>
                    </div>
                    <div id="admin-p2p-transactions-area" class="data-table-wrapper">
                        <p class="loading-text">Loading transactions...</p>
                    </div>
                </div>
                <div id="ad-investments" class="dashboard-card hidden">
                    <h3><i class="fas fa-chart-line"></i> All Investments</h3>
                    <div id="admin-investments-area" class="data-table-wrapper">
                       <p>No investments found.</p>
                    </div>
                </div>
                <div id="ad-support-tickets" class="dashboard-card hidden">
                    <h3><i class="fas fa-life-ring"></i> All Support Tickets</h3>
                     <div id="admin-tickets-list" class="data-table-wrapper">
                       <p>No support tickets found.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="ticket-details-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-button" onclick="closeTicketDetailsModal()">×</span>
            <h3 id="ticket-details-subject">Ticket Subject</h3>
            <p><small>Ticket ID: <span id="ticket-details-id"></span> | Status: <span id="ticket-details-status" style="text-transform:capitalize;"></span></small></p>
            <hr>
            <div id="ticket-messages-container" style="max-height: 300px; overflow-y: auto; margin-bottom:1rem;">
                <!-- Messages will be populated here -->
            </div>
            <div id="ticket-reply-area" class="ticket-reply-area">
                <h4>Reply to Ticket</h4>
                <textarea id="ticket-reply-message" rows="3" placeholder="Your reply..."></textarea>
                <button onclick="submitTicketReply()" class="accent"><i class="fas fa-paper-plane"></i> Send Reply</button>
                <button class="secondary" id="ticket-modal-status-button">Mark as ...</button> <!-- Onclick handled by JS -->
            </div>
        </div>
    </div>

    <div id="admin-edit-kyc-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-button" onclick="closeAdminEditKycModal()">×</span>
            <h3 id="admin-edit-kyc-modal-title">Edit User KYC Details</h3>
            <input type="hidden" id="admin-edit-kyc-userId">
            <div>
                <label for="admin-kyc-bank-name"><i class="fas fa-university"></i> Bank Name:</label>
                <input type="text" id="admin-kyc-bank-name">
                <label for="admin-kyc-bank-account"><i class="fas fa-hashtag"></i> Bank Account:</label>
                <input type="text" id="admin-kyc-bank-account">
                <label for="admin-kyc-usdt-wallet"><i class="fab fa-bitcoin"></i> USDT Wallet:</label>
                <input type="text" id="admin-kyc-usdt-wallet">
                <label for="admin-kyc-telephone"><i class="fas fa-phone"></i> Telephone:</label>
                <input type="text" id="admin-kyc-telephone">
                <label for="admin-kyc-country"><i class="fas fa-globe"></i> Country:</label>
                <select id="admin-kyc-country"></select>
                <label for="admin-kyc-status"><i class="fas fa-user-check"></i> KYC Status:</label>
                <select id="admin-kyc-status">
                    <option value="none">None</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                </select>
                <div id="admin-kyc-rejection-reason-group" class="hidden">
                    <label for="admin-kyc-rejection-reason">Rejection Reason:</label>
                    <textarea id="admin-kyc-rejection-reason" rows="3"></textarea>
                </div>
                 <p id="admin-kyc-doc-display" style="margin-top:0.5rem; margin-bottom:0.5rem;">Current Document: None</p>
                 <label for="admin-kyc-new-document"><i class="fas fa-file-upload"></i> Upload New Document (Optional - replaces existing):</label>
                 <input type="file" id="admin-kyc-new-document" accept="image/*,.pdf">
                <button onclick="saveAdminKycChanges()" class="accent" style="margin-top:1rem;"><i class="fas fa-save"></i> Save KYC Changes</button>
            </div>
        </div>
    </div>

    <footer>
        <p>© <span id="currentYear"></span> P2P Reform Business. All Rights Reserved .</p>
       
    </footer>

    <script src="script.js" defer></script>
</body>
</html>
